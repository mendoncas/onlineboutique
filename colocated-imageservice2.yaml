# Roles and bindings.
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  creationTimestamp: null
  name: pods-getter
  namespace: default
rules:
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - get
  - list
  - watch

---

apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  creationTimestamp: null
  name: default-pods-getter
  namespace: default
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: pods-getter
subjects:
- kind: ServiceAccount
  name: default
  namespace: default

---

# Deployment for replica set main
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  name: onlineboutique-main-0e73c0e0-c6333052
  namespace: default
spec:
  minReadySeconds: 5
  revisionHistoryLimit: 1
  selector:
    matchLabels:
      depName: onlineboutique-main-0e73c0e0-c6333052
  strategy:
    rollingUpdate: {}
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        appName: onlineboutique
        depName: onlineboutique-main-0e73c0e0-c6333052
        metrics: onlineboutique
      namespace: default
    spec:
      containers:
      - args:
        - babysitter
        env:
        - name: SERVICEWEAVER_DEPLOYMENT_CONFIG
          value: CtwOCiQwZTczYzBlMC1kZWRjLTQxNjItYjJhNC01ZTlmYzMwZjE0OTQSsw4KDm9ubGluZWJvdXRpcXVlEhYvd2VhdmVyL29ubGluZWJvdXRpcXVlKo4FCgRtYWluCjNnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvYWRzZXJ2aWNlL1QKNWdpdGh1Yi5jb20vU2VydmljZVdlYXZlci9vbmxpbmVib3V0aXF1ZS9jYXJ0c2VydmljZS9UCj1naXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvY2FydHNlcnZpY2UvY2FydENhY2hlCjlnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvY2hlY2tvdXRzZXJ2aWNlL1QKOWdpdGh1Yi5jb20vU2VydmljZVdlYXZlci9vbmxpbmVib3V0aXF1ZS9jdXJyZW5jeXNlcnZpY2UvVAo2Z2l0aHViLmNvbS9TZXJ2aWNlV2VhdmVyL29ubGluZWJvdXRpcXVlL2VtYWlsc2VydmljZS9UCjhnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvcGF5bWVudHNlcnZpY2UvVAo/Z2l0aHViLmNvbS9TZXJ2aWNlV2VhdmVyL29ubGluZWJvdXRpcXVlL3Byb2R1Y3RjYXRhbG9nc2VydmljZS9UCj9naXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvcmVjb21tZW5kYXRpb25zZXJ2aWNlL1QKOWdpdGh1Yi5jb20vU2VydmljZVdlYXZlci9vbmxpbmVib3V0aXF1ZS9zaGlwcGluZ3NlcnZpY2UvVAo2Z2l0aHViLmNvbS9TZXJ2aWNlV2VhdmVyL29ubGluZWJvdXRpcXVlL2ltYWdlc2VydmljZS9UMIDwksvdCDppCgRrdWJlEmFpbWFnZSA9ICJyaWNhcmRvY2dtL3dlYXZlci1vbmxpbmVib3V0aXF1ZSIKCltsaXN0ZW5lcnNdCiAgW2xpc3RlbmVycy5ib3V0aXF1ZV0KICAgIHB1YmxpYyA9IHRydWUKOk0KBnNpbmdsZRJDW2xpc3RlbmVyc10KICBbbGlzdGVuZXJzLmJvdXRpcXVlXQogICAgYWRkcmVzcyA9ICJsb2NhbGhvc3Q6MTIzNDUiCjpMCgVtdWx0aRJDW2xpc3RlbmVyc10KICBbbGlzdGVuZXJzLmJvdXRpcXVlXQogICAgYWRkcmVzcyA9ICJsb2NhbGhvc3Q6MTIzNDUiCjp1CgNna2USbnJlZ2lvbnMgPSBbInVzLXdlc3QxIl0KCltsaXN0ZW5lcnNdCiAgW2xpc3RlbmVycy5ib3V0aXF1ZV0KICAgIHB1YmxpY19ob3N0bmFtZSA9ICJvbmxpbmVib3V0aXF1ZS5leGFtcGxlLmNvbSIKOvEFCg1zZXJ2aWNld2VhdmVyEt8FYmluYXJ5ID0gIi4vb25saW5lYm91dGlxdWUiCmNvbG9jYXRlID0gW1sibWFpbiIsICJnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvYWRzZXJ2aWNlL1QiLCAiZ2l0aHViLmNvbS9TZXJ2aWNlV2VhdmVyL29ubGluZWJvdXRpcXVlL2NhcnRzZXJ2aWNlL1QiLCAiZ2l0aHViLmNvbS9TZXJ2aWNlV2VhdmVyL29ubGluZWJvdXRpcXVlL2NhcnRzZXJ2aWNlL2NhcnRDYWNoZSIsICJnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvY2hlY2tvdXRzZXJ2aWNlL1QiLCAiZ2l0aHViLmNvbS9TZXJ2aWNlV2VhdmVyL29ubGluZWJvdXRpcXVlL2N1cnJlbmN5c2VydmljZS9UIiwgImdpdGh1Yi5jb20vU2VydmljZVdlYXZlci9vbmxpbmVib3V0aXF1ZS9lbWFpbHNlcnZpY2UvVCIsICJnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvcGF5bWVudHNlcnZpY2UvVCIsICJnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvcHJvZHVjdGNhdGFsb2dzZXJ2aWNlL1QiLCAiZ2l0aHViLmNvbS9TZXJ2aWNlV2VhdmVyL29ubGluZWJvdXRpcXVlL3JlY29tbWVuZGF0aW9uc2VydmljZS9UIiwgImdpdGh1Yi5jb20vU2VydmljZVdlYXZlci9vbmxpbmVib3V0aXF1ZS9zaGlwcGluZ3NlcnZpY2UvVCIsICJnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvaW1hZ2VzZXJ2aWNlL1QiXV0Kcm9sbG91dCA9ICI1bSIKEgRtYWluGj0KOWdpdGh1Yi5jb20vU2VydmljZVdlYXZlci9vbmxpbmVib3V0aXF1ZS9zaGlwcGluZ3NlcnZpY2UvVBIAGjcKM2dpdGh1Yi5jb20vU2VydmljZVdlYXZlci9vbmxpbmVib3V0aXF1ZS9hZHNlcnZpY2UvVBIAGjoKNmdpdGh1Yi5jb20vU2VydmljZVdlYXZlci9vbmxpbmVib3V0aXF1ZS9pbWFnZXNlcnZpY2UvVBIAGkEKPWdpdGh1Yi5jb20vU2VydmljZVdlYXZlci9vbmxpbmVib3V0aXF1ZS9jYXJ0c2VydmljZS9jYXJ0Q2FjaGUSABo9CjlnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvY3VycmVuY3lzZXJ2aWNlL1QSABo6CjZnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvZW1haWxzZXJ2aWNlL1QSABo5CjVnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvY2FydHNlcnZpY2UvVBIAGkMKP2dpdGh1Yi5jb20vU2VydmljZVdlYXZlci9vbmxpbmVib3V0aXF1ZS9yZWNvbW1lbmRhdGlvbnNlcnZpY2UvVBIAGj0KOWdpdGh1Yi5jb20vU2VydmljZVdlYXZlci9vbmxpbmVib3V0aXF1ZS9jaGVja291dHNlcnZpY2UvVBIAGjwKOGdpdGh1Yi5jb20vU2VydmljZVdlYXZlci9vbmxpbmVib3V0aXF1ZS9wYXltZW50c2VydmljZS9UEgAaQwo/Z2l0aHViLmNvbS9TZXJ2aWNlV2VhdmVyL29ubGluZWJvdXRpcXVlL3Byb2R1Y3RjYXRhbG9nc2VydmljZS9UEgAgkE4qB2RlZmF1bHQyNmh0dHA6Ly9vbmxpbmVib3V0aXF1ZS1qYWVnZXItMjg4YmNhMzk6MTQyNjgvYXBpL3RyYWNlcw==
        image: ricardocgm/weaver-onlineboutique:0e73c0e0
        imagePullPolicy: IfNotPresent
        name: serviceweaver
        ports:
        - containerPort: 9090
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
        stdin: true
        tty: true
status: {}

---

# Autoscaler for replica set main
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  creationTimestamp: null
  name: onlineboutique-hpa-main-0e73c0e0-7c9f2054
  namespace: default
spec:
  maxReplicas: 10
  metrics:
  - resource:
      name: cpu
      target:
        averageUtilization: 80
        type: Utilization
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: onlineboutique-main-0e73c0e0-c6333052
status:
  currentMetrics: null
  desiredReplicas: 0

---

# Deployment for replica set github.com/ServiceWeaver/weaver/Main
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  name: onlineboutique-github-com-serviceweaver-weaver-main-dfbca204
  namespace: default
spec:
  minReadySeconds: 5
  revisionHistoryLimit: 1
  selector:
    matchLabels:
      globalName: onlineboutique-github-com-serviceweaver-weaver-main-dfbca204
  strategy:
    rollingUpdate: {}
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        appName: onlineboutique
        depName: onlineboutique-com-serviceweaver-weaver-main-0e73c0e0-d01219d4
        globalName: onlineboutique-github-com-serviceweaver-weaver-main-dfbca204
        metrics: onlineboutique
      namespace: default
    spec:
      containers:
      - args:
        - babysitter
        env:
        - name: SERVICEWEAVER_DEPLOYMENT_CONFIG
          value: CtwOCiQwZTczYzBlMC1kZWRjLTQxNjItYjJhNC01ZTlmYzMwZjE0OTQSsw4KDm9ubGluZWJvdXRpcXVlEhYvd2VhdmVyL29ubGluZWJvdXRpcXVlKo4FCgRtYWluCjNnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvYWRzZXJ2aWNlL1QKNWdpdGh1Yi5jb20vU2VydmljZVdlYXZlci9vbmxpbmVib3V0aXF1ZS9jYXJ0c2VydmljZS9UCj1naXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvY2FydHNlcnZpY2UvY2FydENhY2hlCjlnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvY2hlY2tvdXRzZXJ2aWNlL1QKOWdpdGh1Yi5jb20vU2VydmljZVdlYXZlci9vbmxpbmVib3V0aXF1ZS9jdXJyZW5jeXNlcnZpY2UvVAo2Z2l0aHViLmNvbS9TZXJ2aWNlV2VhdmVyL29ubGluZWJvdXRpcXVlL2VtYWlsc2VydmljZS9UCjhnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvcGF5bWVudHNlcnZpY2UvVAo/Z2l0aHViLmNvbS9TZXJ2aWNlV2VhdmVyL29ubGluZWJvdXRpcXVlL3Byb2R1Y3RjYXRhbG9nc2VydmljZS9UCj9naXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvcmVjb21tZW5kYXRpb25zZXJ2aWNlL1QKOWdpdGh1Yi5jb20vU2VydmljZVdlYXZlci9vbmxpbmVib3V0aXF1ZS9zaGlwcGluZ3NlcnZpY2UvVAo2Z2l0aHViLmNvbS9TZXJ2aWNlV2VhdmVyL29ubGluZWJvdXRpcXVlL2ltYWdlc2VydmljZS9UMIDwksvdCDppCgRrdWJlEmFpbWFnZSA9ICJyaWNhcmRvY2dtL3dlYXZlci1vbmxpbmVib3V0aXF1ZSIKCltsaXN0ZW5lcnNdCiAgW2xpc3RlbmVycy5ib3V0aXF1ZV0KICAgIHB1YmxpYyA9IHRydWUKOk0KBnNpbmdsZRJDW2xpc3RlbmVyc10KICBbbGlzdGVuZXJzLmJvdXRpcXVlXQogICAgYWRkcmVzcyA9ICJsb2NhbGhvc3Q6MTIzNDUiCjpMCgVtdWx0aRJDW2xpc3RlbmVyc10KICBbbGlzdGVuZXJzLmJvdXRpcXVlXQogICAgYWRkcmVzcyA9ICJsb2NhbGhvc3Q6MTIzNDUiCjp1CgNna2USbnJlZ2lvbnMgPSBbInVzLXdlc3QxIl0KCltsaXN0ZW5lcnNdCiAgW2xpc3RlbmVycy5ib3V0aXF1ZV0KICAgIHB1YmxpY19ob3N0bmFtZSA9ICJvbmxpbmVib3V0aXF1ZS5leGFtcGxlLmNvbSIKOvEFCg1zZXJ2aWNld2VhdmVyEt8FYmluYXJ5ID0gIi4vb25saW5lYm91dGlxdWUiCmNvbG9jYXRlID0gW1sibWFpbiIsICJnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvYWRzZXJ2aWNlL1QiLCAiZ2l0aHViLmNvbS9TZXJ2aWNlV2VhdmVyL29ubGluZWJvdXRpcXVlL2NhcnRzZXJ2aWNlL1QiLCAiZ2l0aHViLmNvbS9TZXJ2aWNlV2VhdmVyL29ubGluZWJvdXRpcXVlL2NhcnRzZXJ2aWNlL2NhcnRDYWNoZSIsICJnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvY2hlY2tvdXRzZXJ2aWNlL1QiLCAiZ2l0aHViLmNvbS9TZXJ2aWNlV2VhdmVyL29ubGluZWJvdXRpcXVlL2N1cnJlbmN5c2VydmljZS9UIiwgImdpdGh1Yi5jb20vU2VydmljZVdlYXZlci9vbmxpbmVib3V0aXF1ZS9lbWFpbHNlcnZpY2UvVCIsICJnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvcGF5bWVudHNlcnZpY2UvVCIsICJnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvcHJvZHVjdGNhdGFsb2dzZXJ2aWNlL1QiLCAiZ2l0aHViLmNvbS9TZXJ2aWNlV2VhdmVyL29ubGluZWJvdXRpcXVlL3JlY29tbWVuZGF0aW9uc2VydmljZS9UIiwgImdpdGh1Yi5jb20vU2VydmljZVdlYXZlci9vbmxpbmVib3V0aXF1ZS9zaGlwcGluZ3NlcnZpY2UvVCIsICJnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvb25saW5lYm91dGlxdWUvaW1hZ2VzZXJ2aWNlL1QiXV0Kcm9sbG91dCA9ICI1bSIKEiRnaXRodWIuY29tL1NlcnZpY2VXZWF2ZXIvd2VhdmVyL01haW4aOgokZ2l0aHViLmNvbS9TZXJ2aWNlV2VhdmVyL3dlYXZlci9NYWluEhIKEAoIYm91dGlxdWUQoJwBGAEgkE4qB2RlZmF1bHQyNmh0dHA6Ly9vbmxpbmVib3V0aXF1ZS1qYWVnZXItMjg4YmNhMzk6MTQyNjgvYXBpL3RyYWNlcw==
        image: ricardocgm/weaver-onlineboutique:0e73c0e0
        imagePullPolicy: IfNotPresent
        name: serviceweaver
        ports:
        - containerPort: 9090
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
        stdin: true
        tty: true
status: {}

---

# Autoscaler for replica set github.com/ServiceWeaver/weaver/Main
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  creationTimestamp: null
  name: onlineboutique-hpa-viceweaver-weaver-main-0e73c0e0-79ecf880
  namespace: default
spec:
  maxReplicas: 10
  metrics:
  - resource:
      name: cpu
      target:
        averageUtilization: 80
        type: Utilization
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: onlineboutique-github-com-serviceweaver-weaver-main-dfbca204
status:
  currentMetrics: null
  desiredReplicas: 0

---

# Listener Service for replica set github.com/ServiceWeaver/weaver/Main
apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  labels:
    lisName: boutique
  name: onlineboutique-lis-boutique-b6f227cf
  namespace: default
spec:
  ports:
  - port: 80
    protocol: TCP
    targetPort: 20000
  selector:
    globalName: onlineboutique-github-com-serviceweaver-weaver-main-dfbca204
  type: LoadBalancer
status:
  loadBalancer: {}

---

# Jaeger Deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  name: onlineboutique-jaeger-288bca39
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      jaeger: onlineboutique-jaeger-288bca39
  strategy:
    rollingUpdate: {}
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        jaeger: onlineboutique-jaeger-288bca39
      namespace: default
    spec:
      containers:
      - image: jaegertracing/all-in-one:latest
        imagePullPolicy: IfNotPresent
        name: onlineboutique-jaeger-288bca39
        resources: {}
status: {}

---

# Jaeger Service
apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  name: onlineboutique-jaeger-288bca39
  namespace: default
spec:
  ports:
  - name: ui-port
    port: 16686
    protocol: TCP
    targetPort: 16686
  - name: collector-port
    port: 14268
    protocol: TCP
    targetPort: 14268
  selector:
    jaeger: onlineboutique-jaeger-288bca39
status:
  loadBalancer: {}

---

# Config Map onlineboutique-prometheus-config-9f631fd9
apiVersion: v1
data:
  prometheus.yaml: |2

    global:
      scrape_interval: 15s
    scrape_configs:
      - job_name: "onlineboutique-prometheus-9fafee08"
        metrics_path: /metrics
        kubernetes_sd_configs:
          - role: pod
            namespaces:
              names:
                - default
        scheme: http
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_label_metrics]
            regex: "onlineboutique"
            action: keep
kind: ConfigMap
metadata:
  creationTimestamp: null
  name: onlineboutique-prometheus-config-9f631fd9
  namespace: default

---

# Prometheus Deployment onlineboutique-prometheus-9fafee08
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  name: onlineboutique-prometheus-9fafee08
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      prometheus: onlineboutique-prometheus-9fafee08
  strategy:
    rollingUpdate: {}
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        prometheus: onlineboutique-prometheus-9fafee08
      namespace: default
    spec:
      containers:
      - args:
        - --config.file=/etc/onlineboutique-prometheus-9fafee08/prometheus.yaml
        - --storage.tsdb.path=/onlineboutique-prometheus-9fafee08
        image: prom/prometheus:v2.30.3
        imagePullPolicy: IfNotPresent
        name: onlineboutique-prometheus-9fafee08
        ports:
        - containerPort: 9090
        resources: {}
        volumeMounts:
        - mountPath: /etc/onlineboutique-prometheus-9fafee08/prometheus.yaml
          name: onlineboutique-prometheus-config-9f631fd9
          subPath: prometheus.yaml
        - mountPath: /onlineboutique-prometheus-9fafee08
          name: onlineboutique-prometheus-9fafee08-data
      volumes:
      - configMap:
          items:
          - key: prometheus.yaml
            path: prometheus.yaml
          name: onlineboutique-prometheus-config-9f631fd9
        name: onlineboutique-prometheus-config-9f631fd9
      - name: onlineboutique-prometheus-9fafee08-data
status: {}

---

# Prometheus Service onlineboutique-prometheus-9fafee08
apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  name: onlineboutique-prometheus-9fafee08
  namespace: default
spec:
  ports:
  - port: 80
    protocol: TCP
    targetPort: 9090
  selector:
    prometheus: onlineboutique-prometheus-9fafee08
status:
  loadBalancer: {}

---

# Config Map onlineboutique-loki-config-4b13c7c3
apiVersion: v1
data:
  loki.yaml: |2

    auth_enabled: false
    server:
      http_listen_port: 3100

    common:
      instance_addr: 127.0.0.1
      path_prefix: /tmp/onlineboutique-loki-ccba14cc
      storage:
        filesystem:
          chunks_directory: /tmp/onlineboutique-loki-ccba14cc/chunks
          rules_directory: /tmp/onlineboutique-loki-ccba14cc/rules
      replication_factor: 1
      ring:
        kvstore:
          store: inmemory

    schema_config:
      configs:
        - from: 2023-11-05  # Marks the starting point of this schema
          store: boltdb-shipper
          object_store: filesystem
          schema: v11
          index:
            prefix: index_
            period: 24h
kind: ConfigMap
metadata:
  creationTimestamp: null
  name: onlineboutique-loki-config-4b13c7c3
  namespace: default

---

# Config Map onlineboutique-promtail-d9a077a9
apiVersion: v1
data:
  promtail.yaml: |2

    server:
      log_format: logfmt
      http_listen_port: 3101

    clients:
      - url: http://onlineboutique-loki-ccba14cc:3100/loki/api/v1/push

    positions:
      filename: /run/promtail/positions.yaml

    scrape_configs:
      - job_name: kubernetes-pods
        kubernetes_sd_configs:
          - role: pod
            namespaces:
              names:
                - default
        relabel_configs:
          - source_labels:
              - __meta_kubernetes_pod_label_appName
            regex: ^.*onlineboutique.*$
            action: keep
          - source_labels:
              - __meta_kubernetes_pod_label_appName
            action: replace
            target_label: app
          - source_labels:
              - __meta_kubernetes_pod_name
            action: replace
            target_label: pod
          - action: replace
            replacement: /var/log/pods/*$1/*.log
            separator: /
            source_labels:
            - __meta_kubernetes_pod_uid
            - __meta_kubernetes_pod_container_name
            target_label: __path__
kind: ConfigMap
metadata:
  creationTimestamp: null
  name: onlineboutique-promtail-d9a077a9
  namespace: default

---

# Loki Deployment onlineboutique-loki-ccba14cc
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  name: onlineboutique-loki-ccba14cc
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      loki: onlineboutique-loki-ccba14cc
  strategy:
    rollingUpdate: {}
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        loki: onlineboutique-loki-ccba14cc
      namespace: default
    spec:
      containers:
      - args:
        - --config.file=/etc/onlineboutique-loki-ccba14cc/loki.yaml
        image: grafana/loki:latest
        imagePullPolicy: IfNotPresent
        name: onlineboutique-loki-ccba14cc
        ports:
        - containerPort: 3100
        resources: {}
        volumeMounts:
        - mountPath: /etc/onlineboutique-loki-ccba14cc/
          name: onlineboutique-loki-config-4b13c7c3
      volumes:
      - configMap:
          items:
          - key: loki.yaml
            path: loki.yaml
          name: onlineboutique-loki-config-4b13c7c3
        name: onlineboutique-loki-config-4b13c7c3
status: {}

---

# Loki Service onlineboutique-loki-ccba14cc
apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  name: onlineboutique-loki-ccba14cc
  namespace: default
spec:
  ports:
  - port: 3100
    protocol: TCP
    targetPort: 3100
  selector:
    loki: onlineboutique-loki-ccba14cc
status:
  loadBalancer: {}

---

# Promtail DaemonSet onlineboutique-promtail-d9a077a9
apiVersion: apps/v1
kind: DaemonSet
metadata:
  creationTimestamp: null
  name: onlineboutique-promtail-d9a077a9
  namespace: default
spec:
  selector:
    matchLabels:
      promtail: onlineboutique-promtail-d9a077a9
  template:
    metadata:
      creationTimestamp: null
      labels:
        promtail: onlineboutique-promtail-d9a077a9
      namespace: default
    spec:
      containers:
      - args:
        - --config.file=/etc/onlineboutique-promtail-d9a077a9/promtail.yaml
        env:
        - name: HOSTNAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        image: grafana/promtail:latest
        imagePullPolicy: IfNotPresent
        name: onlineboutique-promtail-d9a077a9
        ports:
        - containerPort: 3101
        resources: {}
        volumeMounts:
        - mountPath: /etc/onlineboutique-promtail-d9a077a9
          name: config
        - mountPath: /run/promtail
          name: run
        - mountPath: /var/lib/docker/containers
          name: containers
          readOnly: true
        - mountPath: /var/log/pods
          name: pods
          readOnly: true
      serviceAccountName: default
      volumes:
      - configMap:
          items:
          - key: promtail.yaml
            path: promtail.yaml
          name: onlineboutique-promtail-d9a077a9
        name: config
      - hostPath:
          path: /run/promtail
        name: run
      - hostPath:
          path: /var/lib/docker/containers
        name: containers
      - hostPath:
          path: /var/log/pods
        name: pods
  updateStrategy:
    rollingUpdate: {}
    type: RollingUpdate
status:
  currentNumberScheduled: 0
  desiredNumberScheduled: 0
  numberMisscheduled: 0
  numberReady: 0

---

# Config Map onlineboutique-grafana-config-9bf239f3
apiVersion: v1
data:
  dashboard-config.yaml: |2

    apiVersion: 1
    providers:
     - name: 'Service Weaver Dashboard'
       options:
         path: /etc/grafana/dashboards/default-dashboard.json
  default-dashboard.json: |
    {
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": {
              "type": "grafana",
              "uid": "-- Grafana --"
            },
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "type": "dashboard"
          }
        ]
      },
      "description": "Basic Service Weaver dashboard",
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "id": 1,
      "links": [],
      "liveNow": false,
      "panels": [
        {
          "collapsed": false,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 0
          },
          "id": 7,
          "panels": [],
          "title": "Metrics",
          "type": "row"
        },
        {
          "datasource": {
            "type": "loki",
            "uid": "P8E80F9AEF21F6940"
          },
          "gridPos": {
            "h": 40,
            "w": 12,
            "x": 0,
            "y": 1
          },
          "id": 2,
          "options": {
            "dedupStrategy": "none",
            "enableLogDetails": true,
            "prettifyLogMessage": false,
            "showCommonLabels": false,
            "showLabels": false,
            "showTime": false,
            "sortOrder": "Descending",
            "wrapLogMessage": false
          },
          "targets": [
            {
              "datasource": {
                "type": "loki",
                "uid": "P8E80F9AEF21F6940"
              },
              "editorMode": "builder",
              "expr": "{app=\"onlineboutique\"}",
              "key": "Q-f5ed4dd4-34d6-449d-b547-a020c1407c9d-0",
              "queryType": "range",
              "refId": "A"
            }
          ],
          "title": "New Panel",
          "type": "logs"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 1
          },
          "id": 3,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "single",
              "sort": "none"
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "builder",
              "expr": "serviceweaver_method_count",
              "instant": false,
              "range": true,
              "refId": "A"
            }
          ],
          "title": "# Method Invocations",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 9
          },
          "id": 9,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "single",
              "sort": "none"
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "builder",
              "expr": "serviceweaver_method_error_count",
              "instant": false,
              "range": true,
              "refId": "A"
            }
          ],
          "title": "# Method Invocations with errors",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "fillOpacity": 80,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 17
          },
          "id": 10,
          "options": {
            "bucketOffset": 0,
            "legend": {
              "calcs": [
                "lastNotNull",
                "min",
                "max",
                "variance"
              ],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "builder",
              "expr": "serviceweaver_method_latency_micros_bucket",
              "instant": false,
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Distribution of latency (us) of Service Weaver component execution",
          "type": "histogram"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "fillOpacity": 80,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 25
          },
          "id": 4,
          "options": {
            "bucketOffset": 0,
            "legend": {
              "calcs": [
                "lastNotNull",
                "min",
                "max",
                "variance"
              ],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "builder",
              "expr": "serviceweaver_method_bytes_request_bucket",
              "instant": false,
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Distribution of #bytes in Service Weaver component method requests",
          "type": "histogram"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "fillOpacity": 80,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 33
          },
          "id": 8,
          "options": {
            "bucketOffset": 0,
            "legend": {
              "calcs": [
                "lastNotNull",
                "min",
                "max",
                "variance"
              ],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "builder",
              "expr": "serviceweaver_method_bytes_reply_bucket",
              "instant": false,
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Distribution of #bytes in Service Weaver component method replies",
          "type": "histogram"
        }
      ],
      "refresh": "5s",
      "schemaVersion": 38,
      "style": "dark",
      "tags": [],
      "templating": {
        "list": []
      },
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "timepicker": {},
      "timezone": "",
      "title": "Service Weaver",
      "uid": "c7fcf5e5-00e9-4af5-a246-0eaf3068ac29",
      "version": 16,
      "weekStart": ""
    }
  grafana.yaml: |2




    apiVersion: 1
    datasources:

     - name: Jaeger
       type: jaeger
       url: http://onlineboutique-jaeger-288bca39:16686

     - name: Prometheus
       type: prometheus
       access: proxy
       url: http://onlineboutique-prometheus-9fafee08
       isDefault: true

     - name: Loki
       type: loki
       access: proxy
       jsonData:
         httpHeaderName1: 'X-Scope-OrgID'
       secureJsonData:
         httpHeaderValue1: 'customvalue'
       url: http://onlineboutique-loki-ccba14cc:3100
kind: ConfigMap
metadata:
  creationTimestamp: null
  name: onlineboutique-grafana-config-9bf239f3
  namespace: default

---
# Grafana Deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  name: onlineboutique-grafana-9a55b334
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      grafana: onlineboutique-grafana-9a55b334
  strategy:
    rollingUpdate: {}
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        grafana: onlineboutique-grafana-9a55b334
      namespace: default
    spec:
      containers:
      - env:
        - name: GF_SECURITY_ADMIN_USER
          value: admin
        - name: GF_SECURITY_ADMIN_PASSWORD
          value: admin
        image: grafana/grafana:latest
        imagePullPolicy: IfNotPresent
        name: onlineboutique-grafana-9a55b334
        ports:
        - containerPort: 3000
        resources: {}
        volumeMounts:
        - mountPath: /etc/grafana/provisioning/datasources/
          name: datasource-volume
        - mountPath: /etc/grafana/provisioning/dashboards/
          name: dashboards-config
        - mountPath: /etc/grafana/dashboards/
          name: dashboards
      volumes:
      - configMap:
          items:
          - key: grafana.yaml
            path: grafana.yaml
          name: onlineboutique-grafana-config-9bf239f3
        name: datasource-volume
      - configMap:
          items:
          - key: dashboard-config.yaml
            path: dashboard-config.yaml
          name: onlineboutique-grafana-config-9bf239f3
        name: dashboards-config
      - configMap:
          items:
          - key: default-dashboard.json
            path: default-dashboard.json
          name: onlineboutique-grafana-config-9bf239f3
        name: dashboards
status: {}

---

# Grafana Service
apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  name: onlineboutique-grafana-9a55b334
  namespace: default
spec:
  ports:
  - name: ui-port
    port: 80
    protocol: TCP
    targetPort: 3000
  selector:
    grafana: onlineboutique-grafana-9a55b334
status:
  loadBalancer: {}

---
